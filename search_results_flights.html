<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="keywords" content="">
	<meta name="description" content="">
	<meta name="author" content="">
	
	<title>All Inclusive Vacation</title>
	
	<link rel="stylesheet" href="css/style.css" />
	<link rel="stylesheet" href="css/theme-turqoise.css" id="template-color" />
	<link rel="stylesheet" href="css/lightslider.min.css" />
	<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:400,600,700,800|Roboto+Slab:400,700&amp;subset=latin,latin-ext,greek-ext,greek,cyrillic,vietnamese,cyrillic-ext">
	<link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
	<link rel="shortcut icon" href="images/favicon.ico" />
	<link rel="stylesheet" href="css/styler.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="css/slick.css"/>
	
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
</head>
<body>
	<!--- loading animation -->
	<div class="loading">
		<div class="ball"></div>
		<div class="ball1"></div>
	</div>
	<!--- //loading animation -->
	
	<!--header-->
	<header class="header inside-header">
		<div class="wrap">
			<!--logo-->
			<div class="logo inside-logo"><a href="index.html" title=""><img src="images/txt/logo.png" alt="Book Your Travel" /></a></div>
			<!--//logo-->
			
			<!--ribbon-->
			<div class="header-nav-buts inside_top-nav">
				<nav>
					<a href="my_account.html" title="My Account">My Account</a>
					<a href="#0" title="Login" id="btnlogin">Login</a>
					<a href="my_account.html" title="Settings">Settings</a>
					</ul>
				</nav>
			</div>
			<!--//ribbon-->
		</div>
	</header>
	<!--//header-->
	
	<!--main-->
	<main class="main">		
		<div class="wrap">
			<!--breadcrumbs-->
			<nav class="breadcrumbs">
				<!--crumbs-->
				<ul>
					<li>Search results</li>                                       
				</ul>
				<!--//crumbs-->
				
				<!--top right navigation-->
				<ul class="top-right-nav">
					<li><a href="#" title="Back to results">Back to results</a></li>
					<li><a href="#" title="Change search">Change search</a></li>
				</ul>
				<!--//top right navigation-->
			</nav>
			<!--//breadcrumbs-->
            <!-- progress step -->
			<div class="process-steps">
                <ul class="book-step-intigator">
                    <li class="active-intigator">
                        <a href="search_results_flights.html"><b><i class="fa fa-plane" aria-hidden="true"></i></b></a>
                        <p>Book Your Flight</p>
                    </li>
                    <li>
                        <a href="search_results-hotel.html"><b><i class="fa fa-bed" aria-hidden="true"></i></b></a>
                        <p>Choose Your Hotel</p>
                    </li>
                    <li>
                        <a href="add_extras.html"><b><i class="fa fa-bus" aria-hidden="true"></i></b></a>
                        <p>Choose Youe Extras</p>
                    </li>
                    <li>
                        <a href="booking-step1.html"><b><i class="fa fa-ticket" aria-hidden="true"></i></b></a>
                        <p>Complete Your Booking</p>
                    </li>
                </ul>
            </div>
            <!-- progress step end -->
			<div class="row">
				<!--sidebar-->
				<aside class="one-fourth left-sidebar">
					<article class="widget refine-search-results">
						<h4>Refine search results</h4>
						<dl>
							<!--Departure times-->
							<dt>Departure times</dt>
							<dd>
								<div class="checkbox">
									<input type="checkbox" id="ch1" name="departure" />
									<label for="ch1">Lowest fare</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch2" name="departure" />
									<label for="ch2">Morning</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch3" name="departure" />
									<label for="ch3">Midday</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch4" name="departure" />
									<label for="ch4">Afternoon</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch5" name="departure" />
									<label for="ch5">Evening</label>
								</div>
							</dd>
							<!--//Departure times-->
							
							<!--Stops-->
							<dt>Stops</dt>
							<dd>
								<div class="checkbox">
									<input type="checkbox" id="ch6" name="stop" />
									<label for="ch6">Direct flights only</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch7" name="stop" />
									<label for="ch7">1 stop</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch8" name="stop" />
									<label for="ch8">2 stops</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch9" name="stop" />
									<label for="ch9">3 stops</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch30" name="stop" />
									<label for="ch30">4 stops</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch31" name="stop" />
									<label for="ch31">I don't mind</label>
								</div>
							</dd>
							<!--//Stops-->

							
							<!--Airlines-->
							<dt>Airlines</dt>
							<dd>
								<div class="checkbox">
									<input type="checkbox" id="ch32" name="airlines" />
									<label for="ch32">British Airways</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch33" name="airlines" />
									<label for="ch33">airberlin</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch34" name="airlines" />
									<label for="ch34">Lufthansa</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch35" name="airlines" />
									<label for="ch35">SAS</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch36" name="airlines" />
									<label for="ch36">Brussels Airlines</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch37" name="airlines" />
									<label for="ch37">Include Low Cost</label>
								</div>
							</dd>
							<!--//Airlines-->
							
							<!--Alliances-->
							<dt>Alliances</dt>
							<dd>
								<div class="checkbox">
									<input type="checkbox" id="ch38" name="alliances" />
									<label for="ch38">One World</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch39" name="alliances" />
									<label for="ch39">Sky Team</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch20" name="alliances" />
									<label for="ch20">Star Alliance </label>
								</div>
							</dd>
							<!--//Alliances-->
							
							<!--Price range-->
							<dt>Price range</dt>
							<dd>
								<div class="checkbox">
									<input type="checkbox" id="ch21" name="price" />
									<label for="ch21">0 - 99 &euro;</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch22" name="price" />
									<label for="ch22">100 - 299 &euro;</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch23" name="price" />
									<label for="ch23">300 - 499 &euro;</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch24" name="price" />
									<label for="ch24">500 - 699 &euro;</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch25" name="price" />
									<label for="ch25">700 &euro; +</label>
								</div>
							</dd>
							<!--//Price range-->
							
							<!--Class-->
							<dt>Class</dt>
							<dd>
								<div class="checkbox">
									<input type="checkbox" id="ch26" name="class" />
									<label for="ch26">Economy</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch27" name="class" />
									<label for="ch27">Business</label>
								</div>
								<div class="checkbox">
									<input type="checkbox" id="ch28" name="class" />
									<label for="ch28">First</label>
								</div>
							</dd>
							<!--//Class-->
						</dl>
					</article>
				</aside>
				<!--//sidebar-->
			
				<!--three-fourth content-->
				<div class="three-fourth">
					<div class="deals flights row results">
						<!--deal-->
						<div id="flight-details" class="flight-details">
						</div>
                        <div class="load-more-scroll"></div>
						<!--//deal-->
					</div>
				</div>
				<!--//three-fourth content-->
			</div>
			<!--//main content-->
		</div>
	</main>
	<!--//main-->
	
	<!--footer-->
	<footer class="footer">
		<div class="wrap">
			<div class="row">
				<!--column-->
				<article class="one-half margin_zero">
                	<a href="#" class="foot_logo"><img src="images/txt/logo.png" /></a>
					<h6>BOOK BY PHONE (+44) 845 468 0164</h6>
				</article>
				<!--//column-->
				<!--column-->
				<article class="one-half" style="margin-top: 20px;">
                		<h6>Follow us</h6>
                		<ul class="social">
							<li><a href="#0" class="twitter"><i class="fa fa-twitter" aria-hidden="true"></i> Twitter</a></li>
							<li><a href="#0" class="instagrame"><i class="fa fa-instagram" aria-hidden="true"></i> Instagram</a></li>
							<li><a href="#0" class="facebook"><i class="fa fa-facebook" aria-hidden="true"></i> Facebook</a></li>
							<li><a href="#0" class="google"><i class="fa fa-google-plus" aria-hidden="true"></i> Google+</a></li>
							<li><a href="#0" class="youtube"><i class="fa fa-youtube" aria-hidden="true"></i> YouTube</a></li>
						</ul>
				</article>
				<!--//column-->

                <div class="full-width">
                	<nav>
						<ul>
							<li><a href="gentral-pages.html" title="About us">About us</a></li>
                            <li><a href="#" title="About us">Careers</a></li>
                            <li><a href="#" title="About us">Press</a></li>
                            <li><a href="#" title="About us">Blog</a></li>
                            <li><a href="#" title="About us">Help</a></li>
                            <li><a href="#" title="Policies">Policies</a></li>
                            <li><a href="#" title="Disaster Response">Disaster Response</a></li>
							<li><a href="#" title="Contact">Terms & Privacy</a></li>
						</ul>
					</nav>
                </div>
				
				<div class="bottom full-width">
					<p class="copy">Copyright © 2016 All Inclusive Vacation. All rights reserved.</p>
				</div>
			</div>
		</div>
	</footer>
	<!---footer-->

    <div class="lightbox" id="login">
		<div class="lb-wrap">
			<a href="#" class="close">x</a>
			<div class="lb-content">
				<form class="row">
					<h3>Log in</h3>
					<div class="f-item full-width">
						<label for="email">E-mail address</label>
						<input type="email" id="email" name="email" />
					</div>
					<div class="f-item full-width">
						<label for="password">Password</label>
						<input type="password" id="password" name="password" />
					</div>
					<div class="f-item checkbox full-width">
						<input type="checkbox" id="remember_me" name="checkbox" />
						<label for="remember_me">Remember me next time</label>
					</div>
					<div class="f-item full-width">
						<p><a href="#" title="Forgot password?">Forgot password?</a><br />
						Dont have an account yet? <a href="#0" title="Sign up" id="btnregister">Sign up.</a></p>
						<input type="submit" id="login" name="login" value="login" class="gradient-button" />
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- register -->
    <div class="lightbox" id="register">
		<div class="lb-wrap">
			<a href="#" class="close">x</a>
			<div class="lb-content">
				<form class="row">
					<h3>Register</h3>
					<div class="f-item full-width">
						<label for="f_name">Name and surname</label>
						<input type="text" id="ns_name" name="ns_name" />
					</div>
					<div class="f-item full-width">
						<label for="email">E-mail address</label>
						<input type="email" id="email" name="email" />
					</div>
					<div class="f-item full-width">
						<label for="password">Password</label>
						<input type="password" id="password" name="password" />
					</div>
					<div class="f-item checkbox full-width">
						<input type="checkbox" id="newsletter_s" name="newsletter" />
						<label for="newsletter_s">Tell me about inspiring travel news, and exclusive discounts!</label>
					</div>
					<div class="f-item checkbox full-width">
						<p>By clicking "Create Account" you confirm that you accept the <a href="#">Terms of Service</a> and <a href="#">Privacy Policy</a>. </p>
						<input type="submit" id="register" name="register" value="Create Account" class="gradient-button" />
					</div>
				</form>
			</div>
		</div>
	</div>	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
	<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.11.4/jquery-ui.min.js"></script>
	<script type="text/javascript" src="js/jquery.uniform.min.js"></script>
	<script type="text/javascript" src="js/jquery.slimmenu.min.js"></script>
	<script type="text/javascript" src="js/jquery.raty.min.js"></script>
	<script type="text/javascript" src="js/loadmore.js"></script>
	<script type="text/javascript" src="js/scripts.js"></script>
	<script type="text/javascript" src="js/search.js"></script>
	
	<script>
	$(window).load(function(){
	     $("html,body").trigger("scroll");
	});
	var counter=0;
	$(document).on('ready', function() {
	
	var values=JSON.parse(localStorage.getItem('flightvals'));
	flighturl="https://mgmpackages.azurewebsites.net/mgmpackages/API/FlightSearch?StartDate="+values.whenv+"&ReturnDate="+values.tillwhenv+"&FlightFrom="+values.fromv+"&FlightTo="+values.tov+"&Adults="+values.adultv+"&Children="+values.childrenv+"&Infants="+values.infantv;
	console.log(flighturl);
	$('body').children().hide();
	$('body').append('<div class="loading"><div class="ball"></div><div class="ball1"></div></div>');
	
	/*NEW LAZY LOADING CODE */
	$("#flight-details").loadJson({
            url: flighturl,
            loadBtn: '#btn',
            getData: function(elem, data) {
                $.each(data, function(index, value) {
		counter++;
                    $('.flight-details').append('<article id="flight-child" class="full-width flightchild" priceid='+value.TotalFareAmount+'><div class="details"><h3>'+value.OACode+value.FlightNumber+'</h3><div class="f-wrap"><h5>Airline</h5><div class="flight-info"><img src="http://mgmpackages.azurewebsites.net/mgmpackages/images/OA/'+ value.OACode + '@2x.png");" /></div></div><div class="f-wrap"><h5>Departure</h5><div class="flight-info">'+formatdate(value.ArrivalDatetime)+'<br/><strong>'+generatename(value.ArrivalAirportLocationCode)+'</strong></div></div><div class="f-wrap"><h5>Arrival</h5><div class="flight-info">' +formatdate(value.DepartDatetime)+'</strong> '+generatename(value.DepartAirportLocationCode)+'</div></div><div class="f-wrap"><h5>Duration of trip:</h5><div class="flight-info">'+value.JourneyDuration + ' Minutes </div><div class="flight-info"><strong>Stops</strong> '+value.NumberofStops+'</div></div><span class="price"><strong>First class</strong> Price per passenger <em>&euro; '+value.TotalFareAmount+'</em></span><div class="description"><p>*This fare includes the cost of a hold bag for each passenger</p> <a href="' + value.fSource + '" target="_blank">Please click to view the fare Rules</a></div><a title="Book now" uniqueid='+counter+' class="gradient-button bookflight">Book now</a></div></div></article>');
					$('.flightchild').sort(function(a,b){
									   return (parseInt($(b).attr('priceid'))) < parseInt(($(a).attr('priceid'))) ? 1 : -1;   
									 }).appendTo($('.flight-details'));
						});
		$('body').find('.loading').remove();
		$('body').children().show();
		$('#register, #login, #forged-pass').hide();
            }
        });
		
	/*OLD CODE
		$.ajax({
			url: flighturl,
			success: function (data)
			{
			$('body').find('.loading').remove();
			$('body').children().show();
			$('#register, #login, #forged-pass').hide();
			//data=[{"PackageSessionID":"ad3c2736-8b11-444c-9825-005b3228c51d","ArrivalAirportLocationCode":"FAO","ArrivalDatetime":"2016-11-07T22:05:00","DepartAirportLocationCode":"STN","DepartDatetime":"2016-11-07T19:10:00","FlightNumber":"9282","JourneyDuration":175,"ResBookDesigCode":"","OACode":"FR","OAEquipment":"","OAFlightNumber":null,"SeatsRemaining":0,"NumberofStops":0,"MarriageGroup":"","Eticket":true,"CabinClassCode":"Y","MealCode":"","SeatsRemainingBelowMinimum":false,"ArrivalAirportLocationCode_RET":"STN","ArrivalDatetime_RET":"2016-11-14T18:45:00","DepartAirportLocationCode_RET":"FAO","DepartDatetime_RET":"2016-11-14T15:45:00","FlightNumber_RET":"9283","JourneyDuration_RET":180,"ResBookDesigCode_RET":"","OACode_RET":"FR","OAEquipment_RET":"","OAFlightNumber_RET":null,"SeatsRemaining_RET":0,"NumberofStops_RET":0,"MarriageGroup_RET":"","Eticket_RET":true,"CabinClassCode_RET":"Y","MealCode_RET":"","SeatsRemainingBelowMinimum_RET":false,"FareSourceCode":"ODAwMDIyJlRGJlRGJjc5ZmI4ODcxLTNiZDctNDNhYi05MGMxLTcxZjhhMjAyMjIzYyZURiY=","BaseFareAmount":"138.56","BaseFareCurr":"GBP","TotalTaxAmount":"3.10","TotalTaxCurr":"EUR","TotalFareAmount":"158.20","TotalFareCurr":"EUR","EquivFareAmount":"155.10","EquivFareCurr":"EUR","FareType":"WebFare","IsPassportMandatory":true,"ValidatingAirlineCode":"FR","DivideInPartyIndicator":false},{"PackageSessionID":"ad3c2736-8b11-444c-9825-005b3228c51d","ArrivalAirportLocationCode":"FAO","ArrivalDatetime":"2016-11-07T14:55:00","DepartAirportLocationCode":"LTN","DepartDatetime":"2016-11-07T12:05:00","FlightNumber":"2019","JourneyDuration":170,"ResBookDesigCode":"Y","OACode":"U2","OAEquipment":"","OAFlightNumber":null,"SeatsRemaining":0,"NumberofStops":0,"MarriageGroup":"","Eticket":true,"CabinClassCode":"Y","MealCode":"","SeatsRemainingBelowMinimum":false,"ArrivalAirportLocationCode_RET":"LGW","ArrivalDatetime_RET":"2016-11-14T23:35:00","DepartAirportLocationCode_RET":"FAO","DepartDatetime_RET":"2016-11-14T20:45:00","FlightNumber_RET":"8918","JourneyDuration_RET":170,"ResBookDesigCode_RET":"Y","OACode_RET":"U2","OAEquipment_RET":"","OAFlightNumber_RET":null,"SeatsRemaining_RET":0,"NumberofStops_RET":0,"MarriageGroup_RET":"","Eticket_RET":true,"CabinClassCode_RET":"Y","MealCode_RET":"","SeatsRemainingBelowMinimum_RET":false,"FareSourceCode":"ODAwMDA3JlRGJlRGJjc5ZmI4ODcxLTNiZDctNDNhYi05MGMxLTcxZjhhMjAyMjIzYyZURiY=","BaseFareAmount":"164.96","BaseFareCurr":"GBP","TotalTaxAmount":"31.39","TotalTaxCurr":"EUR","TotalFareAmount":"216.04","TotalFareCurr":"EUR","EquivFareAmount":"184.65","EquivFareCurr":"EUR","FareType":"WebFare","IsPassportMandatory":true,"ValidatingAirlineCode":"U2","DivideInPartyIndicator":false},{"PackageSessionID":"ad3c2736-8b11-444c-9825-005b3228c51d","ArrivalAirportLocationCode":"FAO","ArrivalDatetime":"2016-11-07T20:15:00","DepartAirportLocationCode":"LGW","DepartDatetime":"2016-11-07T17:25:00","FlightNumber":"8917","JourneyDuration":170,"ResBookDesigCode":"Y","OACode":"U2","OAEquipment":"","OAFlightNumber":null,"SeatsRemaining":0,"NumberofStops":0,"MarriageGroup":"","Eticket":true,"CabinClassCode":"Y","MealCode":"","SeatsRemainingBelowMinimum":false,"ArrivalAirportLocationCode_RET":"LGW","ArrivalDatetime_RET":"2016-11-14T23:35:00","DepartAirportLocationCode_RET":"FAO","DepartDatetime_RET":"2016-11-14T20:45:00","FlightNumber_RET":"8918","JourneyDuration_RET":170,"ResBookDesigCode_RET":"Y","OACode_RET":"U2","OAEquipment_RET":"","OAFlightNumber_RET":null,"SeatsRemaining_RET":0,"NumberofStops_RET":0,"MarriageGroup_RET":"","Eticket_RET":true,"CabinClassCode_RET":"Y","MealCode_RET":"","SeatsRemainingBelowMinimum_RET":false,"FareSourceCode":"ODAwMDA5JlRGJlRGJjc5ZmI4ODcxLTNiZDctNDNhYi05MGMxLTcxZjhhMjAyMjIzYyZURiY=","BaseFareAmount":"180.96","BaseFareCurr":"GBP","TotalTaxAmount":"31.57","TotalTaxCurr":"EUR","TotalFareAmount":"234.13","TotalFareCurr":"EUR","EquivFareAmount":"202.56","EquivFareCurr":"EUR","FareType":"WebFare","IsPassportMandatory":true,"ValidatingAirlineCode":"U2","DivideInPartyIndicator":false},{"PackageSessionID":"ad3c2736-8b11-444c-9825-005b3228c51d","ArrivalAirportLocationCode":"FAO","ArrivalDatetime":"2016-11-07T09:20:00","DepartAirportLocationCode":"LGW","DepartDatetime":"2016-11-07T06:30:00","FlightNumber":"8913","JourneyDuration":170,"ResBookDesigCode":"Y","OACode":"U2","OAEquipment":"","OAFlightNumber":null,"SeatsRemaining":0,"NumberofStops":0,"MarriageGroup":"","Eticket":true,"CabinClassCode":"Y","MealCode":"","SeatsRemainingBelowMinimum":false,"ArrivalAirportLocationCode_RET":"LGW","ArrivalDatetime_RET":"2016-11-14T23:35:00","DepartAirportLocationCode_RET":"FAO","DepartDatetime_RET":"2016-11-14T20:45:00","FlightNumber_RET":"8918","JourneyDuration_RET":170,"ResBookDesigCode_RET":"Y","OACode_RET":"U2","OAEquipment_RET":"","OAFlightNumber_RET":null,"SeatsRemaining_RET":0,"NumberofStops_RET":0,"MarriageGroup_RET":"","Eticket_RET":true,"CabinClassCode_RET":"Y","MealCode_RET":"","SeatsRemainingBelowMinimum_RET":false,"FareSourceCode":"ODAwMDA1JlRGJlRGJjc5ZmI4ODcxLTNiZDctNDNhYi05MGMxLTcxZjhhMjAyMjIzYyZURiY=","BaseFareAmount":"180.96","BaseFareCurr":"GBP","TotalTaxAmount":"31.57","TotalTaxCurr":"EUR","TotalFareAmount":"234.13","TotalFareCurr":"EUR","EquivFareAmount":"202.56","EquivFareCurr":"EUR","FareType":"WebFare","IsPassportMandatory":true,"ValidatingAirlineCode":"U2","DivideInPartyIndicator":false},{"PackageSessionID":"ad3c2736-8b11-444c-9825-005b3228c51d","ArrivalAirportLocationCode":"FAO","ArrivalDatetime":"2016-11-07T14:55:00","DepartAirportLocationCode":"LTN","DepartDatetime":"2016-11-07T12:05:00","FlightNumber":"2019","JourneyDuration":170,"ResBookDesigCode":"Y","OACode":"U2","OAEquipment":"","OAFlightNumber":null,"SeatsRemaining":0,"NumberofStops":0,"MarriageGroup":"","Eticket":true,"CabinClassCode":"Y","MealCode":"","SeatsRemainingBelowMinimum":false,"ArrivalAirportLocationCode_RET":"LGW","ArrivalDatetime_RET":"2016-11-14T12:40:00","DepartAirportLocationCode_RET":"FAO","DepartDatetime_RET":"2016-11-14T09:50:00","FlightNumber_RET":"8914","JourneyDuration_RET":170,"ResBookDesigCode_RET":"Y","OACode_RET":"U2","OAEquipment_RET":"","OAFlightNumber_RET":null,"SeatsRemaining_RET":0,"NumberofStops_RET":0,"MarriageGroup_RET":"","Eticket_RET":true,"CabinClassCode_RET":"Y","MealCode_RET":"","SeatsRemainingBelowMinimum_RET":false,"FareSourceCode":"ODAwMDA2JlRGJlRGJjc5ZmI4ODcxLTNiZDctNDNhYi05MGMxLTcxZjhhMjAyMjIzYyZURiY=","BaseFareAmount":"212.96","BaseFareCurr":"GBP","TotalTaxAmount":"31.92","TotalTaxCurr":"EUR","TotalFareAmount":"270.30","TotalFareCurr":"EUR","EquivFareAmount":"238.38","EquivFareCurr":"EUR","FareType":"WebFare","IsPassportMandatory":true,"ValidatingAirlineCode":"U2","DivideInPartyIndicator":false},{"PackageSessionID":"ad3c2736-8b11-444c-9825-005b3228c51d","ArrivalAirportLocationCode":"FAO","ArrivalDatetime":"2016-11-07T20:15:00","DepartAirportLocationCode":"LGW","DepartDatetime":"2016-11-07T17:25:00","FlightNumber":"8917","JourneyDuration":170,"ResBookDesigCode":"Y","OACode":"U2","OAEquipment":"","OAFlightNumber":null,"SeatsRemaining":0,"NumberofStops":0,"MarriageGroup":"","Eticket":true,"CabinClassCode":"Y","MealCode":"","SeatsRemainingBelowMinimum":false,"ArrivalAirportLocationCode_RET":"LGW","ArrivalDatetime_RET":"2016-11-14T12:40:00","DepartAirportLocationCode_RET":"FAO","DepartDatetime_RET":"2016-11-14T09:50:00","FlightNumber_RET":"8914","JourneyDuration_RET":170,"ResBookDesigCode_RET":"Y","OACode_RET":"U2","OAEquipment_RET":"","OAFlightNumber_RET":null,"SeatsRemaining_RET":0,"NumberofStops_RET":0,"MarriageGroup_RET":"","Eticket_RET":true,"CabinClassCode_RET":"Y","MealCode_RET":"","SeatsRemainingBelowMinimum_RET":false,"FareSourceCode":"ODAwMDA4JlRGJlRGJjc5ZmI4ODcxLTNiZDctNDNhYi05MGMxLTcxZjhhMjAyMjIzYyZURiY=","BaseFareAmount":"228.96","BaseFareCurr":"GBP","TotalTaxAmount":"32.10","TotalTaxCurr":"EUR","TotalFareAmount":"288.39","TotalFareCurr":"EUR","EquivFareAmount":"256.29","EquivFareCurr":"EUR","FareType":"WebFare","IsPassportMandatory":true,"ValidatingAirlineCode":"U2","DivideInPartyIndicator":false},{"PackageSessionID":"ad3c2736-8b11-444c-9825-005b3228c51d","ArrivalAirportLocationCode":"FAO","ArrivalDatetime":"2016-11-07T09:20:00","DepartAirportLocationCode":"LGW","DepartDatetime":"2016-11-07T06:30:00","FlightNumber":"8913","JourneyDuration":170,"ResBookDesigCode":"Y","OACode":"U2","OAEquipment":"","OAFlightNumber":null,"SeatsRemaining":0,"NumberofStops":0,"MarriageGroup":"","Eticket":true,"CabinClassCode":"Y","MealCode":"","SeatsRemainingBelowMinimum":false,"ArrivalAirportLocationCode_RET":"LGW","ArrivalDatetime_RET":"2016-11-14T12:40:00","DepartAirportLocationCode_RET":"FAO","DepartDatetime_RET":"2016-11-14T09:50:00","FlightNumber_RET":"8914","JourneyDuration_RET":170,"ResBookDesigCode_RET":"Y","OACode_RET":"U2","OAEquipment_RET":"","OAFlightNumber_RET":null,"SeatsRemaining_RET":0,"NumberofStops_RET":0,"MarriageGroup_RET":"","Eticket_RET":true,"CabinClassCode_RET":"Y","MealCode_RET":"","SeatsRemainingBelowMinimum_RET":false,"FareSourceCode":"ODAwMDA0JlRGJlRGJjc5ZmI4ODcxLTNiZDctNDNhYi05MGMxLTcxZjhhMjAyMjIzYyZURiY=","BaseFareAmount":"228.96","BaseFareCurr":"GBP","TotalTaxAmount":"32.10","TotalTaxCurr":"EUR","TotalFareAmount":"288.39","TotalFareCurr":"EUR","EquivFareAmount":"256.29","EquivFareCurr":"EUR","FareType":"WebFare","IsPassportMandatory":true,"ValidatingAirlineCode":"U2","DivideInPartyIndicator":false},{"PackageSessionID":"ad3c2736-8b11-444c-9825-005b3228c51d","ArrivalAirportLocationCode":"FAO","ArrivalDatetime":"2016-11-07T17:05:00","DepartAirportLocationCode":"LGW","DepartDatetime":"2016-11-07T14:10:00","FlightNumber":"2692","JourneyDuration":175,"ResBookDesigCode":"O","OACode":"BA","OAEquipment":"320","OAFlightNumber":null,"SeatsRemaining":9,"NumberofStops":0,"MarriageGroup":"O","Eticket":true,"CabinClassCode":"Y","MealCode":"M","SeatsRemainingBelowMinimum":false,"ArrivalAirportLocationCode_RET":"LGW","ArrivalDatetime_RET":"2016-11-14T20:45:00","DepartAirportLocationCode_RET":"FAO","DepartDatetime_RET":"2016-11-14T17:55:00","FlightNumber_RET":"2693","JourneyDuration_RET":170,"ResBookDesigCode_RET":"N","OACode_RET":"BA","OAEquipment_RET":"320","OAFlightNumber_RET":null,"SeatsRemaining_RET":6,"NumberofStops_RET":0,"MarriageGroup_RET":"O","Eticket_RET":true,"CabinClassCode_RET":"Y","MealCode_RET":"M","SeatsRemainingBelowMinimum_RET":false,"FareSourceCode":"MTAwMDAxJlc5REgmMUImNzlmYjg4NzEtM2JkNy00M2FiLTkwYzEtNzFmOGEyMDIyMjNjJlc5REgm","BaseFareAmount":"198.00","BaseFareCurr":"GBP","TotalTaxAmount":"91.61","TotalTaxCurr":"EUR","TotalFareAmount":"313.24","TotalFareCurr":"EUR","EquivFareAmount":"221.63","EquivFareCurr":"EUR","FareType":"Private","IsPassportMandatory":false,"ValidatingAirlineCode":"BA","DivideInPartyIndicator":false}];
			localStorage.setItem("flightdetails",JSON.stringify(data));
			if(data != "null" || data != '' || data.length > 0)
			{
			localStorage.removeItem('flightvals');
			}
			
			debugger;
			console.log(data.length);
			for(var i=0;i<data.length;i++)
			{
			$('.flight-details').append('<article class="full-width flightchild hidden" priceid='+data[i].TotalFareAmount+'><div class="details"><h3>'+data[i].OACode+data[i].FlightNumber+'</h3><div class="f-wrap"><h5>Airline</h5><div class="flight-info"><img src="http://mgmpackages.azurewebsites.net/mgmpackages/images/OA/'+ data[i].OACode + '@2x.png");" /></div></div><div class="f-wrap"><h5>Departure</h5><div class="flight-info">'+formatdate(data[i].ArrivalDatetime)+'<br/><strong>'+generatename(data[i].ArrivalAirportLocationCode)+'</strong></div></div><div class="f-wrap"><h5>Arrival</h5><div class="flight-info">' +formatdate(data[i].DepartDatetime)+'</strong> '+generatename(data[i].DepartAirportLocationCode)+'</div></div><div class="f-wrap"><h5>Duration of trip:</h5><div class="flight-info">'+data[i].JourneyDuration + ' Minutes </div><div class="flight-info"><strong>Stops</strong> '+data[i].NumberofStops+'</div></div><span class="price"><strong>First class</strong> Price per passenger <em>&euro; '+data[i].TotalFareAmount+'</em></span><div class="description"><p>*This fare includes the cost of a hold bag for each passenger</p> <a href="' + data[i].fSource + '" target="_blank">Please click to view the fare Rules</a></div><a title="Book now" uniqueid='+i+' class="gradient-button bookflight">Book now</a></div></div></article>');
			$('.flightchild').sort(function(a,b){
							   return (parseInt($(b).attr('priceid'))) < parseInt(($(a).attr('priceid'))) ? 1 : -1;   
							 }).appendTo($('.flight-details'));
			//alert(JSON.stringify(data));
			}
			loadMore();
			},
			dataType: 'json',
			type: 'GET'
		})
		
	}else{
	var flightd=JSON.parse(localStorage.getItem('flightdetails'));
		for (i=0;i<3;i++)
		{
		$('.flight-details').append('<article class="full-width flightchild hidden" priceid='+flightd[i].TotalFareAmount+'><div class="details"><h3>'+flightd[i].OACode+flightd[i].FlightNumber+'</h3><div class="f-wrap"><h5>Airline</h5><div class="flight-info"><img src="http://mgmpackages.azurewebsites.net/mgmpackages/images/OA/'+ flightd[i].OACode + '@2x.png");" /></div></div><div class="f-wrap"><h5>Departure</h5><div class="flight-info">'+formatdate(flightd[i].ArrivalDatetime)+'<br/><strong>'+generatename(flightd[i].ArrivalAirportLocationCode)+'</strong></div></div><div class="f-wrap"><h5>Arrival</h5><div class="flight-info">' +formatdate(flightd[i].DepartDatetime)+'</strong> '+generatename(flightd[i].DepartAirportLocationCode)+'</div></div><div class="f-wrap"><h5>Duration of trip:</h5><div class="flight-info">'+flightd[i].JourneyDuration + ' Minutes </div><div class="flight-info"><strong>Stops</strong> '+flightd[i].NumberofStops+'</div></div><span class="price"><strong>First class</strong> Price per passenger <em>&euro; '+flightd[i].TotalFareAmount+'</em></span><div class="description"><p>*This fare includes the cost of a hold bag for each passenger</p> <a href="' + flightd[i].fSource + '" target="_blank">Please click to view the fare Rules</a></div><a title="Book now" uniqueid='+i+' class="gradient-button bookflight">Book now</a></div></div></article>');
		$('.flightchild').sort(function(a,b){
							   return (parseInt($(b).attr('priceid'))) < parseInt(($(a).attr('priceid'))) ? 1 : -1;   
							 }).appendTo($('.flight-details'));
		}
		//loadMore();
	}
	*/
		
		$(document).on('click','.bookflight', function (event){
		//console.log('hi');
		$('body').children().hide();
		$('body').append('<div class="loading"><div class="ball"></div><div class="ball1"></div></div>');
		var fd=JSON.parse(localStorage.getItem('flightdetails'))[event.currentTarget.attributes[1].value];
		postData={
		FareSourceCode:fd.FareSourceCode,
		SessionID:fd.PackageSessionID,
		RCount:1
		};
		 mUrl = 'http://mgmpackages.azurewebsites.net/mgmpackages/API/airrevalidate';
		 $.ajax({
						   url: mUrl,
							type: "GET",
							data: postData,
							crossDomain: true,
							dataType: "json",
							timeout: 320000,
							success: function (data, textStatus, jqXHR) {},
							error: function (jqXHR, textStatus, errorThrown) {}
						}).done(function (dataJson) {
							
							if (dataJson.OverallResult == 'revalidatesuccess') 
							{ 
							 window.location.href = window.location.href.split('search_results_flights.html')[0]+"search_results-hotel.html";
							}
							else if (dataJson.OverallResult == 'revalidatesuccesswithprice' || dataJson.OverallResult == 'revalidatefailurewithprice') 
							{	
								
								var newData;
									if (dataJson.lstFlightSearchRS != null && dataJson.lstFlightSearchRS.length > 0) 
									{
										newData = dataJson.lstFlightSearchRS[0];
										var oldvalues=JSON.parse(localStorage.getItem('flightdetails'));
										console.log('old value:'+oldvalues[event.currentTarget.attributes[1].value].TotalFareAmount+' and new value:'+newData.TotalFareAmount);
										if(oldvalues[event.currentTarget.attributes[1].value].TotalFareAmount!=newData.TotalFareAmount)
										{
										oldvalues[event.currentTarget.attributes[1].value].TotalFareAmount=newData.TotalFareAmount;
										oldvalues[event.currentTarget.attributes[1].value].FareSourceCode=newData.FareSourceCode;
										oldvalues[event.currentTarget.attributes[1].value].PackageSessionID=newData.PackageSessionID;
										localStorage.removeItem('flightdetails');
										localStorage.setItem('flightdetails',JSON.stringify(oldvalues));
											$('body').find('.loading').remove();
											$('body').children().show();
											if (confirm('The price got changed to'+newData.TotalFareAmount)) {
											window.location.href = window.location.href.split('search_results_flights.html')[0]+"search_results-hotel.html";
											localStorage.setItem('fd',JSON.stringify(fd));
											}
											else{
											window.location.reload();
											}
										}
										else{
										localStorage.setItem('fd',JSON.stringify(fd));
										window.location.href = window.location.href.split('search_results_flights.html')[0]+"search_results-hotel.html";
										}
									}
									else
									{
									localStorage.setItem('fd',JSON.stringify(fd));
									window.location.href = window.location.href.split('search_results_flights.html')[0]+"search_results-hotel.html";
									}
							}
							else if(dataJson.OverallResult=="revalidatecompletefailure")
							{
								$('body').find('.loading').remove();
								$('body').children().show();
								alert('an error occured');
							
							}
						});
		});
		})
	
		
		function generatename(value){
		return JSON.parse(localStorage.getItem('airport'))[value][0].LocationName;
		}
		
		function formatdate(datev){
				var datev= new Date(datev);
				var Timerange=datev.getHours()+":"+ minvalue(datev.getMinutes());
				var nw=datev.toDateString().split(' ');
				return Timerange+' '+nw[0]+','+nw[2]+' '+nw[1];	
			}
		function minvalue(month){
			if(month <9)
			return '0'+month;
			else
			return month;
		}
	</script>
</body>
</html>